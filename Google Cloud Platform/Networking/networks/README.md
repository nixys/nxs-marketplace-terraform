# Networks

## Introduction

This is a set of terraform modules for the Google Cloud Platform provider for building a networks and creating any different networks resources

## Features

- Supported networks
- Supported firewalls
- Supported router-nats
- Supported routes
- Supported static-ips
- Supported subnetworks

## Settings

| Option | Type | Required | Default value |Description |
| --- | ---  | --- | --- | --- |
| `networks.description` | String | No | "Created by Terraform" | An optional description of this resource. The resource must be recreated to modify this field. |
| `networks.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `networks.auto_create_subnetworks` | Bool | No | null | When set to true, the network is created in "auto subnet mode" and it will create a subnet for each region automatically across the 10.128.0.0/9 address range. When set to false, the network is created in "custom subnet mode" so the user can explicitly connect subnetwork resources. |
| `networks.routing_mode` | String | No | null | The network-wide routing mode to use. If set to REGIONAL, this network's cloud routers will only advertise routes with subnetworks of this network in the same region as the router. If set to GLOBAL, this network's cloud routers will advertise routes with all subnetworks of this network, across regions. Possible values are: REGIONAL, GLOBAL. |
| `networks.mtu` | Int | No | null | Maximum Transmission Unit in bytes. The default value is 1460 bytes. The minimum value for this field is 1300 and the maximum value is 8896 bytes (jumbo frames). Note that packets larger than 1500 bytes (standard Ethernet) can be subject to TCP-MSS clamping or dropped with an ICMP Fragmentation-Needed message if the packets are routed to the Internet or other VPCs with varying MTUs. |
| `networks.enable_ula_internal_ipv6` | Bool | No | null | Enable ULA internal ipv6 on this network. Enabling this feature will assign a /48 from google defined ULA prefix fd20::/20. |
| `networks.internal_ipv6_range` | String | No | null | When enabling ula internal ipv6, caller optionally can specify the /48 range they want from the google defined ULA prefix fd20::/20. The input must be a valid /48 ULA IPv6 address and must be within the fd20::/20. Operation will fail if the speficied /48 is already in used by another resource. If the field is not speficied, then a /48 range will be randomly allocated from fd20::/20 and returned via this field. |
| `networks.network_firewall_policy_enforcement_order` | String | No | null | Set the order that Firewall Rules and Firewall Policies are evaluated. Default value is AFTER_CLASSIC_FIREWALL. Possible values are: BEFORE_CLASSIC_FIREWALL, AFTER_CLASSIC_FIREWALL. |
| `networks.delete_default_routes_on_create` | Bool | No | null | If set to true, default routes (0.0.0.0/0) will be deleted immediately after network creation. Defaults to false. |
| `subnetworks.description` | String | No | "Created by Terraform" | An optional description of this resource. Provide this property when you create the resource. This field can be set only at resource creation time. |
| `subnetworks.ip_cidr_range` | String | Yes | - | The range of internal addresses that are owned by this subnetwork. Provide this property when you create the subnetwork. For example, 10.0.0.0/8 or 192.168.0.0/16. Ranges must be unique and non-overlapping within a network. Only IPv4 is supported. |
| `subnetworks.network_name` | String | Yes | - | The network this subnet belongs to. Only networks that are in the distributed mode can have subnetworks. |
| `subnetworks.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `subnetworks.secondary_ip_range` | List | No | [] | An array of configurations for secondary IP ranges for VM instances contained in this subnetwork. The primary IP of such VM must belong to the primary ipCidrRange of the subnetwork. The alias IPs may belong to either primary or secondary ranges. Note: This field uses attr-as-block mode to avoid breaking users during the 0.12 upgrade. To explicitly send a list of zero objects you must use the following syntax: example=[] |
| `subnetworks.secondary_ip_range.range_name` | String | Yes | - | The name associated with this subnetwork secondary range, used when adding an alias IP range to a VM instance. The name must be 1-63 characters long, and comply with RFC1035. The name must be unique within the subnetwork. |
| `subnetworks.secondary_ip_range.ip_cidr_range` | String | Yes | - | The range of IP addresses belonging to this subnetwork secondary range. Provide this property when you create the subnetwork. Ranges must be unique and non-overlapping with all primary and secondary IP ranges within a network. Only IPv4 is supported. |
| `subnetworks.private_ip_google_access` | Bool | No | null | When enabled, VMs in this subnetwork without external IP addresses can access Google APIs and services by using Private Google Access. |
| `subnetworks.private_ipv6_google_access` | String | No | null | The private IPv6 google access type for the VMs in this subnet. |
| `subnetworks.region` | String | No | null | The GCP region for this subnetwork. |
| `subnetworks.log_config` | List | No | [] | This field denotes the VPC flow logging options for this subnetwork. If logging is enabled, logs are exported to Cloud Logging. Flow logging isn't supported if the subnet purpose field is set to subnetwork is REGIONAL_MANAGED_PROXY or GLOBAL_MANAGED_PROXY. |
| `subnetworks.log_config.aggregation_interval` | String | No | null | Can only be specified if VPC flow logging for this subnetwork is enabled. Toggles the aggregation interval for collecting flow logs. Increasing the interval time will reduce the amount of generated flow logs for long lasting connections. Default is an interval of 5 seconds per connection. Default value is INTERVAL_5_SEC. Possible values are: INTERVAL_5_SEC, INTERVAL_30_SEC, INTERVAL_1_MIN, INTERVAL_5_MIN, INTERVAL_10_MIN, INTERVAL_15_MIN. |
| `subnetworks.log_config.flow_sampling` | Int | No | null | Can only be specified if VPC flow logging for this subnetwork is enabled. The value of the field must be in [0, 1]. Set the sampling rate of VPC flow logs within the subnetwork where 1.0 means all collected logs are reported and 0.0 means no logs are reported. Default is 0.5 which means half of all collected logs are reported. |
| `subnetworks.log_config.metadata` | String | No | null | Can only be specified if VPC flow logging for this subnetwork is enabled. Configures whether metadata fields should be added to the reported VPC flow logs. Default value is INCLUDE_ALL_METADATA. Possible values are: EXCLUDE_ALL_METADATA, INCLUDE_ALL_METADATA, CUSTOM_METADATA. |
| `subnetworks.log_config.metadata_fields` | String | No | null | List of metadata fields that should be added to reported logs. Can only be specified if VPC flow logs for this subnetwork is enabled and "metadata" is set to CUSTOM_METADATA. |
| `subnetworks.stack_type` | String | No | null | The stack type for this subnet to identify whether the IPv6 feature is enabled or not. If not specified IPV4_ONLY will be used. Possible values are: IPV4_ONLY, IPV4_IPV6. |
| `subnetworks.ipv6_access_type` | String | No | null | The access type of IPv6 address this subnet holds. It's immutable and can only be specified during creation or the first time the subnet is updated into IPV4_IPV6 dual stack. If the ipv6_type is EXTERNAL then this subnet cannot enable direct path. Possible values are: EXTERNAL, INTERNAL. |
| `firewalls.description` | String | No | "Created by Terraform" | An optional description of this resource. Provide this property when you create the resource. |
| `firewalls.network` | String | Yes | - | The name or self_link of the network to attach this firewall to. |
| `firewalls.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `firewalls.allow` | List | No | [] | The list of ALLOW rules specified by this firewall. Each rule specifies a protocol and port-range tuple that describes a permitted connection. |
| `firewalls.allow.protocol` | String | Yes | - | The IP protocol to which this rule applies. The protocol type is required when creating a firewall rule. This value can either be one of the following well known protocol strings (tcp, udp, icmp, esp, ah, sctp, ipip, all), or the IP protocol number. |
| `firewalls.allow.ports` | List | No | [] | An optional list of ports to which this rule applies. This field is only applicable for UDP or TCP protocol. Each entry must be either an integer or a range. If not specified, this rule applies to connections through any port. Example inputs include: ["22"], ["80","443"], and ["12345-12349"]. |
| `firewalls.deny` | List | No | [] | The list of DENY rules specified by this firewall. Each rule specifies a protocol and port-range tuple that describes a denied connection. |
| `firewalls.deny.protocol` | String | Yes | - | The IP protocol to which this rule applies. The protocol type is required when creating a firewall rule. This value can either be one of the following well known protocol strings (tcp, udp, icmp, esp, ah, sctp, ipip, all), or the IP protocol number. |
| `firewalls.deny.ports` | List | No | [] | An optional list of ports to which this rule applies. This field is only applicable for UDP or TCP protocol. Each entry must be either an integer or a range. If not specified, this rule applies to connections through any port. Example inputs include: ["22"], ["80","443"], and ["12345-12349"]. |
| `firewalls.destination_ranges` | String | No | null | If destination ranges are specified, the firewall will apply only to traffic that has destination IP address in these ranges. These ranges must be expressed in CIDR format. IPv4 or IPv6 ranges are supported. |
| `firewalls.direction` | String | No | null | Direction of traffic to which this firewall applies; default is INGRESS. Note: For INGRESS traffic, one of source_ranges, source_tags or source_service_accounts is required. Possible values are: INGRESS, EGRESS. |
| `firewalls.disabled` | Bool | No | null | Denotes whether the firewall rule is disabled, i.e not applied to the network it is associated with. When set to true, the firewall rule is not enforced and the network behaves as if it did not exist. If this is unspecified, the firewall rule will be enabled. |
| `firewalls.log_config` | List | No | [] | This field denotes the logging options for a particular firewall rule. If defined, logging is enabled, and logs will be exported to Cloud Logging. |
| `firewalls.log_config.metadata` | String | Yes | - | This field denotes whether to include or exclude metadata for firewall logs. Possible values are: EXCLUDE_ALL_METADATA, INCLUDE_ALL_METADATA. |
| `firewalls.priority` | String | No | null | Priority for this rule. This is an integer between 0 and 65535, both inclusive. When not specified, the value assumed is 1000. Relative priorities determine precedence of conflicting rules. Lower value of priority implies higher precedence (eg, a rule with priority 0 has higher precedence than a rule with priority 1). DENY rules take precedence over ALLOW rules having equal priority. |
| `firewalls.source_ranges` | String | No | null | If source ranges are specified, the firewall will apply only to traffic that has source IP address in these ranges. These ranges must be expressed in CIDR format. One or both of sourceRanges and sourceTags may be set. If both properties are set, the firewall will apply to traffic that has source IP address within sourceRanges OR the source IP that belongs to a tag listed in the sourceTags property. The connection does not need to match both properties for the firewall to apply. IPv4 or IPv6 ranges are supported. For INGRESS traffic, one of source_ranges, source_tags or source_service_accounts is required. |
| `firewalls.source_service_accounts` | String | No | null | If source service accounts are specified, the firewall will apply only to traffic originating from an instance with a service account in this list. Source service accounts cannot be used to control traffic to an instance's external IP address because service accounts are associated with an instance, not an IP address. sourceRanges can be set at the same time as sourceServiceAccounts. If both are set, the firewall will apply to traffic that has source IP address within sourceRanges OR the source IP belongs to an instance with service account listed in sourceServiceAccount. The connection does not need to match both properties for the firewall to apply. sourceServiceAccounts cannot be used at the same time as sourceTags or targetTags. For INGRESS traffic, one of source_ranges, source_tags or source_service_accounts is required. |
| `firewalls.source_tags` | List | No | [] | If source tags are specified, the firewall will apply only to traffic with source IP that belongs to a tag listed in source tags. Source tags cannot be used to control traffic to an instance's external IP address. Because tags are associated with an instance, not an IP address. One or both of sourceRanges and sourceTags may be set. If both properties are set, the firewall will apply to traffic that has source IP address within sourceRanges OR the source IP that belongs to a tag listed in the sourceTags property. The connection does not need to match both properties for the firewall to apply. For INGRESS traffic, one of source_ranges, source_tags or source_service_accounts is required. |
| `firewalls.target_service_accounts` | String | No | null | A list of service accounts indicating sets of instances located in the network that may make network connections as specified in allowed[]. targetServiceAccounts cannot be used at the same time as targetTags or sourceTags. If neither targetServiceAccounts nor targetTags are specified, the firewall rule applies to all instances on the specified network. |
| `firewalls.target_tags` | List | No | [] | A list of instance tags indicating sets of instances located in the network that may make network connections as specified in allowed[]. If no targetTags are specified, the firewall rule applies to all instances on the specified network. |
| `routers.description` | String | No | "Created by Terraform" | An optional description of this resource. |
| `routers.network` | String | Yes | - | A reference to the network to which this router belongs. |
| `routers.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `routers.region` | String | No | null | Region where the router resides. |
| `routers.bgp` | List | Yes | [] | BGP information specific to this router. |
| `routers.bgp.asn` | Int | No | - | Local BGP Autonomous System Number (ASN). Must be an RFC6996 private ASN, either 16-bit or 32-bit. The value will be fixed for this router resource. All VPN tunnels that link to this router will have the same local ASN. |
| `routers.bgp.advertise_mode` | String | No | null | User-specified flag to indicate which mode to use for advertisement. Default value is DEFAULT. Possible values are: DEFAULT, CUSTOM. |
| `routers.bgp.advertised_groups` | String | No | null | User-specified list of prefix groups to advertise in custom mode. This field can only be populated if advertiseMode is CUSTOM and is advertised to all peers of the router. These groups will be advertised in addition to any specified prefixes. Leave this field blank to advertise no custom groups. This enum field has the one valid value: ALL_SUBNETS |
| `routers.bgp.keepalive_interval` | String | No | null | The interval in seconds between BGP keepalive messages that are sent to the peer. Hold time is three times the interval at which keepalive messages are sent, and the hold time is the maximum number of seconds allowed to elapse between successive keepalive messages that BGP receives from a peer. BGP will use the smaller of either the local hold time value or the peer's hold time value as the hold time for the BGP connection between the two peers. If set, this value must be between 20 and 60. The default is 20. |
| `routers.bgp.advertised_ip_ranges` | List | No | [] | User-specified list of individual IP ranges to advertise in custom mode. This field can only be populated if advertiseMode is CUSTOM and is advertised to all peers of the router. These IP ranges will be advertised in addition to any specified groups. Leave this field blank to advertise no custom IP ranges. |
| `routers.bgp.advertised_ip_ranges.range` | String | Yes | - | The IP range to advertise. The value must be a CIDR-formatted string. |
| `routers.bgp.advertised_ip_ranges.description` | String | No | "Created by Terraform" | User-specified description for the IP range. |
| `router_nats.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `router_nats.region` | String | No | null | Region where the router and NAT reside. |
| `router_nats.source_subnetwork_ip_ranges_to_nat` | String | Yes | - | How NAT should be configured per Subnetwork. If ALL_SUBNETWORKS_ALL_IP_RANGES, all of the IP ranges in every Subnetwork are allowed to Nat. If ALL_SUBNETWORKS_ALL_PRIMARY_IP_RANGES, all of the primary IP ranges in every Subnetwork are allowed to Nat. LIST_OF_SUBNETWORKS: A list of Subnetworks are allowed to Nat (specified in the field subnetwork below). Note that if this field contains ALL_SUBNETWORKS_ALL_IP_RANGES or ALL_SUBNETWORKS_ALL_PRIMARY_IP_RANGES, then there should not be any other RouterNat section in any Router for this network in this region. Possible values are: ALL_SUBNETWORKS_ALL_IP_RANGES, ALL_SUBNETWORKS_ALL_PRIMARY_IP_RANGES, LIST_OF_SUBNETWORKS. |
| `router_nats.router` | String | Yes | - | The name of the Cloud Router in which this NAT will be configured. |
| `router_nats.nat_ip_allocate_option` | String | No | null | How external IPs should be allocated for this NAT. Valid values are AUTO_ONLY for only allowing NAT IPs allocated by Google Cloud Platform, or MANUAL_ONLY for only user-allocated NAT IP addresses. Possible values are: MANUAL_ONLY, AUTO_ONLY. |
| `router_nats.nat_ips` | List | No | [] | Self-links of NAT IPs. Only valid if natIpAllocateOption is set to MANUAL_ONLY. |
| `router_nats.subnetwork` | List | No | [] | One or more subnetwork NAT configurations. Only used if source_subnetwork_ip_ranges_to_nat is set to LIST_OF_SUBNETWORKS. |
| `router_nats.subnetwork.name` | String | Yes | - | Self-link of subnetwork to NAT. |
| `router_nats.subnetwork.source_ip_ranges_to_nat` | String | No | null | List of options for which source IPs in the subnetwork should have NAT enabled. Supported values include: ALL_IP_RANGES, LIST_OF_SECONDARY_IP_RANGES, PRIMARY_IP_RANGE. |
| `router_nats.subnetwork.secondary_ip_range_names` | String | No | null | List of the secondary ranges of the subnetwork that are allowed to use NAT. This can be populated only if LIST_OF_SECONDARY_IP_RANGES is one of the values in sourceIpRangesToNat. |
| `router_nats.min_ports_per_vm` | String | No | null | Minimum number of ports allocated to a VM from this NAT. Defaults to 64 for static port allocation and 32 dynamic port allocation if not set. |
| `router_nats.max_ports_per_vm` | String | No | null | Maximum number of ports allocated to a VM from this NAT. This field can only be set when enableDynamicPortAllocation is enabled. |
| `router_nats.enable_dynamic_port_allocation` | Bool | No | null | Enable Dynamic Port Allocation. If minPortsPerVm is set, minPortsPerVm must be set to a power of two greater than or equal to 32. If minPortsPerVm is not set, a minimum of 32 ports will be allocated to a VM from this NAT config. If maxPortsPerVm is set, maxPortsPerVm must be set to a power of two greater than minPortsPerVm. If maxPortsPerVm is not set, a maximum of 65536 ports will be allocated to a VM from this NAT config. Mutually exclusive with enableEndpointIndependentMapping. |
| `router_nats.udp_idle_timeout_sec` | String | No | null | Timeout (in seconds) for UDP connections. Defaults to 30s if not set. |
| `router_nats.icmp_idle_timeout_sec` | String | No | null | Timeout (in seconds) for ICMP connections. Defaults to 30s if not set. |
| `router_nats.tcp_established_idle_timeout_sec` | String | No | null | Timeout (in seconds) for TCP established connections. Defaults to 1200s if not set. |
| `router_nats.tcp_transitory_idle_timeout_sec` | String | No | null | Timeout (in seconds) for TCP transitory connections. Defaults to 30s if not set. |
| `router_nats.tcp_time_wait_timeout_sec` | String | No | null | Timeout (in seconds) for TCP connections that are in TIME_WAIT state. Defaults to 120s if not set. |
| `router_nats.log_config` | List | No | [] | Configuration for logging on NAT. |
| `router_nats.log_config.enable` | Bool | Yes | - | Indicates whether or not to export logs. |
| `router_nats.log_config.filter` | String | Yes | - | Specifies the desired filtering of logs on this NAT. Possible values are: ERRORS_ONLY, TRANSLATIONS_ONLY, ALL. |
| `router_nats.rules` | List | No | [] | A list of rules associated with this NAT.  |
| `router_nats.rules.rule_number` | Int | Yes | - | An integer uniquely identifying a rule in the list. The rule number must be a positive value between 0 and 65000, and must be unique among rules within a NAT. |
| `router_nats.rules.description` | String | No | "Created by Terraform" | An optional description of this rule. |
| `router_nats.rules.match` | String | Yes | - | CEL expression that specifies the match condition that egress traffic from a VM is evaluated against. If it evaluates to true, the corresponding action is enforced. The following examples are valid match expressions for public NAT: "inIpRange(destination.ip, '1.1.0.0/16') || inIpRange(destination.ip, '2.2.0.0/16')" "destination.ip == '1.1.0.1' || destination.ip == '8.8.8.8'" The following example is a valid match expression for private NAT: "nexthop.hub == 'https://networkconnectivity.googleapis.com/v1alpha1/projects/my-project/global/hub/hub-1'" |
| `router_nats.rules.action` | List | Yes | [] | The action to be enforced for traffic that matches this rule. |
| `router_nats.rules.action.source_nat_active_ips` | String | No | null | A list of URLs of the IP resources used for this NAT rule. These IP addresses must be valid static external IP addresses assigned to the project. This field is used for public NAT. |
| `router_nats.rules.action.source_nat_drain_ips` | String | No | null | A list of URLs of the IP resources to be drained. These IPs must be valid static external IPs that have been assigned to the NAT. These IPs should be used for updating/patching a NAT rule only. This field is used for public NAT. |
| `router_nats.enable_endpoint_independent_mapping` | Bool | No | null | Enable endpoint independent mapping. |
| `static_ips.address` | String | No | null | The static external IP address represented by this resource. The IP address must be inside the specified subnetwork, if any. Set by the API if undefined. |
| `static_ips.address_type` | String | No | null | The type of address to reserve. Note: if you set this argument's value as INTERNAL you need to leave the network_tier argument unset in that resource block. Default value is EXTERNAL. Possible values are: INTERNAL, EXTERNAL. |
| `static_ips.description` | String | No | "Created by Terraform" | An optional description of this resource. |
| `static_ips.region` | String | No | null | The Region in which the created address should reside. If it is not provided, the provider region is used. |
| `static_ips.project` | String | No | null | The ID of the project in which the resource belongs. If it is not provided, the provider project is used. |
| `static_ips.purpose` | String | No | null | The purpose of this resource, which can be one of the following values. |
| `static_ips.network_tier` | String | No | null | The networking tier used for configuring this address. If this field is not specified, it is assumed to be PREMIUM. This argument should not be used when configuring Internal addresses, because network tier cannot be set for internal traffic; it's always Premium. Possible values are: PREMIUM, STANDARD. |
| `static_ips.subnetwork` | String | No | null | The URL of the subnetwork in which to reserve the address. If an IP address is specified, it must be within the subnetwork's IP range. This field can only be used with INTERNAL type with GCE_ENDPOINT/DNS_RESOLVER purposes. |
| `static_ips.network` | String | No | null | The URL of the network in which to reserve the address. This field can only be used with INTERNAL type with the VPC_PEERING and IPSEC_INTERCONNECT purposes. |
| `static_ips.prefix_length` | String | No | null | The prefix length if the resource represents an IP range. |
| `static_ips.ip_version` | String | No | null | The IP Version that will be used by this address. The default value is IPV4. Possible values are: IPV4, IPV6. |
| `static_ips.ipv6_endpoint_type` | String | No | null | The endpoint type of this address, which should be VM or NETLB. This is used for deciding which type of endpoint this address can be used after the external IPv6 address reservation. Possible values are: VM, NETLB. |
| `static_ips.labels` | Map | No | {} | Labels to apply to this address. A list of key->value pairs. |

## Example

Usage example located in this [directory](docs/example).
